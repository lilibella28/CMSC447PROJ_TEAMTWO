
---

# ğŸ§¾ Visa Management System â€” Backend

This repository contains the **backend** for the Visa Management System built with **Flask**, **PostgreSQL**, and **SQLAlchemy**.
The backend provides RESTful APIs for managing employees, visas, and expiration alerts.

---

## ğŸ§± Project Structure

```
CMSC447PROJ_TEAMTWO/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py      # Flask app setup
â”‚   â”‚   â”œâ”€â”€ config.py        # Configuration (PostgreSQL, env vars)
â”‚   â”‚   â”œâ”€â”€ models.py        # Database models (User, Employee, Visa, Alert)
â”‚   â”‚
â”‚   â”œâ”€â”€ create_db.py         # Script to create database automatically
â”‚   â”œâ”€â”€ migrations/          # Alembic migration files
â”‚   â””â”€â”€ venv/                # Virtual environment (local use only)
â”‚
â”œâ”€â”€ .env                     # Local environment variables (ignored by Git)
â”œâ”€â”€ .env.example             # Template for teammates to copy
â”œâ”€â”€ requirements.txt         # Python dependencies
â””â”€â”€ wsgi.py                  # Entry point to run the Flask app
```

---

## ğŸš€ Features

* Flask backend connected to PostgreSQL
* SQLAlchemy ORM models
* Flask-Migrate for schema versioning
* Environment-based configuration (`.env`)
* Ready for deployment on Render, Railway, or Heroku

---

## ğŸ§© 1. Prerequisites

Make sure you have installed:

* **Python 3.10+**
* **PostgreSQL**
* **pip** (Python package manager)

Verify installation:

```bash
python3 --version
psql --version
```

---

## âš™ï¸ 2. Clone the Project

```bash
git clone <your-repository-link>
cd CMSC447PROJ_TEAMTWO
```

---

## ğŸ§° 3. Set Up the Virtual Environment

Inside the `backend` folder:

```bash
cd backend
python3 -m venv venv
source venv/bin/activate   # macOS/Linux
# OR
venv\Scripts\activate      # Windows
```

---

## ğŸ“¦ 4. Install Dependencies

```bash
pip install -r requirements.txt
```

---

## ğŸ” 5. Configure Environment Variables

At the project root (same level as `wsgi.py`), create a `.env` file:

```bash
FLASK_ENV=development
SECRET_KEY=mysecretkey

DB_USER=postgres
DB_PASSWORD=yourpassword
DB_HOST=localhost
DB_PORT=5432
DB_NAME=visa_db
```

> Each teammate should use their own local PostgreSQL credentials.
> You can copy the example file and update it:
>
> ```bash
> cp .env.example .env
> ```

---

## ğŸ—„ï¸ 6. Create the Database

Make sure PostgreSQL is running, then execute:

```bash
python backend/create_db.py
```

âœ… This will create the database (`visa_db`) if it does not already exist.

---

## ğŸ§  7. Initialize and Apply Migrations

Once the database exists, apply the existing migrations:

```bash
export FLASK_APP=wsgi.py      # macOS/Linux
# OR
set FLASK_APP=wsgi.py         # Windows PowerShell

flask db upgrade
```

> You **do not need** to run `flask db init` again â€” itâ€™s already initialized in the repo.

---

## ğŸ§© 8. Run the Flask Server

```bash
python wsgi.py
```

Then open your browser:
ğŸ‘‰ [http://127.0.0.1:5000](http://127.0.0.1:5000)

If everything is configured correctly, you should see:

```json
{"message": "Visa Management Backend running"}
```

---

## ğŸ§© 9. Common Commands

| Action                  | Command                         |
| ----------------------- | ------------------------------- |
| Start the server        | `python wsgi.py`                |
| Apply migrations        | `flask db upgrade`              |
| Generate new migration  | `flask db migrate -m "message"` |
| Check current migration | `flask db current`              |
| Access PostgreSQL shell | `psql -U postgres -d visa_db`   |

---

## ğŸ§° 10. Troubleshooting

### ğŸ§© Database connection errors

If you see:

```
psql: FATAL:  role "postgres" does not exist
```

â†’ Create the postgres role:

```sql
CREATE ROLE postgres WITH LOGIN SUPERUSER PASSWORD 'yourpassword';
```

### ğŸ§© Database doesnâ€™t exist

If you see:

```
FATAL:  database "visa_db" does not exist
```

â†’ Run:

```bash
python backend/create_db.py
```

### ğŸ§© Migrations folder missing

If `flask db` says:

```
Error: No such command 'db'
```

Make sure `Flask-Migrate` is installed and `migrate = Migrate(app, db)` is initialized inside `backend/app/__init__.py`.

---

## ğŸ§© 11. Contributing

1. Create a feature branch

   ```bash
   git checkout -b feature/your-feature
   ```
2. Commit your changes

   ```bash
   git commit -m "Add new feature"
   ```
3. Push to the branch

   ```bash
   git push origin feature/your-feature
   ```
4. Create a Pull Request

---

## ğŸ§¾ License

This project is for academic and collaborative use by the CMSC447 Team Two.
All rights reserved Â© 2025.

---
